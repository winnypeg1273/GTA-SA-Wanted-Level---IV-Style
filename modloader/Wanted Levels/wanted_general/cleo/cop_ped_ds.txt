{$CLEO .cs}
{$USE ini}
thread 'COPS_PEDS'

:START
wait 0
gosub @LOAD
gosub @LOAD_COPS
gosub @ASM
jump @START

:LOAD
if or
   not Model.Available(#COLT45)
   not Model.Available(#NITESTICK)
jf @RETURN
Model.Load(#COLT45)
Model.Load(#NITESTICK)
038B: load_requested_models
jump @LOAD

:LOAD_COPS
if or
   not Model.Available(#ARMY)
   not Model.Available(#SFPD1)
   not Model.Available(#DSHER)
   not Model.Available(#M4)
jf @RETURN   
Model.Load(#ARMY)
Model.Load(#SFPD1)
Model.Load(#DSHER)
Model.Load(#M4)
038B: load_requested_models
jump @LOAD_COPS

:ASM
wait 0
077E: get_active_interior_to $ACTIVE_INTERIOR
if
   $ACTIVE_INTERIOR == 0
jf @RETURN
0A8D: 0@ = read_memory 0xC87AB9 size 1 virtual_protect 0 
if 
   not 0@ == 16
jf @ASM_6
0A8C: write_memory 0x5DDCBF size 1 value 22 virtual_protect 0  
0A8C: write_memory 0x68BBB7 size 1 value 22 virtual_protect 1
0A8C: write_memory 0x5DDCCD size 1 value 3 virtual_protect 1

:ASM_2
wait 0
if
    $CURRENT_TOWN_NUMBER == 2
jf @ASM_4
0A8D: 0@ = read_memory 0x8A5AA8 size 4 virtual_protect 0
if
   not 0@ == #SFPD1
jf @RETURN
0A8C: write_memory 0x8A5AA8 size 4 value #SFPD1 virtual_protect 0
return

:ASM_4
wait 0
if or
    Player.InZone($PLAYER_CHAR, 'RED')
    Player.InZone($PLAYER_CHAR, 'FLINTC')
    Player.InZone($PLAYER_CHAR, 'WHET')
jf @ASM_5
0A8D: 0@ = read_memory 0x8A5AA0 size 2 virtual_protect 0
if
   not 0@ == #CSHER
jf @RETURN
0A8C: write_memory 0x8A5AA0 size 2 value #CSHER virtual_protect 0
return

:ASM_5
wait 0
if or
    Player.InZone($PLAYER_CHAR, 'BONE')
    Player.InZone($PLAYER_CHAR, 'ROBAD')
    Player.InZone($PLAYER_CHAR, 'ROBAD1')
jf @RETURN
0A8D: 0@ = read_memory 0x8A5AA0 size 2 virtual_protect 0
if
   not 0@ == #DSHER
jf @RETURN
0A8C: write_memory 0x8A5AA0 size 2 value #DSHER virtual_protect 0
return


:ASM_6
wait 0
0A8C: write_memory 0x8A5AA0 size 2 value #ARMY virtual_protect 0
0A8C: write_memory 0x8A5AA8 size 4 value #ARMY virtual_protect 0
0A8C: write_memory 0x5DDCBF size 1 value 31 virtual_protect 0  
0A8C: write_memory 0x68BBB7 size 1 value 31 virtual_protect 1
0A8C: write_memory 0x5DDCCD size 1 value 0 virtual_protect 1

:RETURN
return